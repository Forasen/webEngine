自动化学报
ACTA AUTOMATICA SINICA
1999年 第25卷 第6期 Vol.25 No.6 1999



一种离散事件系统实时控制器的设计
王　蓓　吴智铭
摘　要　针对实时离散事件系统，提出了一种实时动态控制器的设计方法.用有限状态机FSM(Finite State Machine)对系统进行建模.用时态逻辑TL (Temporal Logic)给出系统的规范化要求.通过这两种形式化方法的有效结合，实现了控制器动态监控的功能.
关键词　FSM，时态逻辑，监控器，动态控制器.
AN APPROACH FOR DESIGNING REAL 
TIME DES CONTROLLER
WANG Bei　WU Zhiming
(Dept.of Automation,Shanghai Jiaotong Univ,Shanghai　200030)
Abstract　A new design method is presented for discrete event system(DES)controller.DES is modeled by finte state mechanism(FSM).The system specification is described by using temporal logic(TL).With the combination of these two formal methods,one can not only realize the DES supervisor to maintain close-loop beha-vior in the allowed state domain,but also add control actions dynamically to enforce the system to meet the required dynamic specification.
Key words　Finite state machine, temporal logic, supervisor,dynamic controller.
1　引言
　　由Ramadge和Wonham提出的监控理论［2］是一种反馈控制机制，通过禁止某些可控事件的发生，保证系统的闭环行为.但在实际系统运行中，不仅要禁止“坏”的事件发生，而且要求施加外部控制，使系统按照所期望的行为变化.前者属静态规范，后者为动态规范，即设计有动态特性的控制器.考虑系统的实时性，在控制器设计过程中，应该将时间因子引入到系统的建模和规范化中，从而导出离散事件系统实时控制器的设计方法.

2　系统的建模与规范化
2.1　用有限状态机建立系统模型
　　使用标识化FSM作为系统的模型，定义为5元组M=｛Q,Σ，δ，q0,Qm｝，其中Q为状态集，q∈Q,Σ为变迁集，δ∈Σ，δ为状态变迁函数，定义为δ:Σ×Q→Q,q0为起始状态；Qm为标识状态.
　　本文以标识化FSM对系统中的每一个对象，分别建立其FSM模型，假定各个事件不在同一瞬刻发生，整个系统的模型则为系统中所有对象的FSM非同步积形式.
　　定义1.FSM的非同步积(‖).
　　给定两个对象FSM M1:｛Q1,Σ1,δ1,q01,Qm1｝和M2:｛Q2,Σ2,δ2,q02,Qm2｝，并且，.非同步积是由每一个状态机的状态相互穿插［3］构成MR:｛QR,ΣR,δR,q0R,QmR｝，其中，与某一状态q对应的状态变量qR∈QR，并且δ(σ,qR)=qR,δ(μ,qR)=q″R.
　　FSM的非同步积对构造整个系统模型十分重要.以火车经离道口(M1)时闸门起落(M2)为例.火车驰近闸门时，门应放下，车远离后，门应抬起，其状态和事件转移标记由表1给出.由表1可得出M1,M2和它们之间非同步积M3的FSM，示于图1，2，3.注意，非同步积M3的结构在未施加控制时，其中包含不允许存在的状态，如(2，0).
表1　火车-道口系统状态变迁表

对象FSM图状态标记意义变量值转移标记意义关联
火车M11S0火车甚远011进邻区S0→S1
S1火车接近112过闸门S1→S2
S2火车在闸213远离去S2→S0
闸门M22S0闸门已开021闸门关闭S0→S1
S1闸门已关122闸门打开S1→S0


图1　火车经离


图2　闸门起落


图3　火车-道口系统M3
2.2　用时态逻辑给出系统规范化
　　对控制结构，都应事先提出所允许的系统行为，以便分析系统和设计监控器.由于FSM方法很难给出复杂系统的形式化规范化需求，因此本文采用时态逻辑TL作规范描述［1］.TL有丰富的代数结构，能够用简洁的模型来表达高度复杂的规范化需求.TL代数与TMS状态变迁之间存在对应关系.在控制器综合时，可用FSM来描述局部控制器.
　　规范化建模分为：静态规范体现系统逻辑不变特性，用TL的谓词逻辑子句来实现；动态规范描述期望事件的发生序列，用TL的时态逻辑算子来实现.对Train-Gate系统，
　　静态规范
S：(2，0)=false,　　(1)
S表示当火车通过道口时，闸门不能打开，这个状态为禁止状态；
　　动态规范
　　　(2)
　　(3)
　　(4)
上式中以→表示过程；○表示下一步时态算子；D1表示当火车接近时，下一个发生的事件为放下闸门；D2表示火车离开且没有新火车开来时，下一个发生的事件应抬起闸门，如果又有火车紧接着开来，闸门仍然关闭；D3表示当门放下后，紧接着发生的不应是抬起闸门.
3　控制器综合
　　当建立了系统的FSM模型及给出了系统的TL规范化后，就可以设计系统的控制器，使闭环系统的行为满足规范化需求.为进行控制器综合，给出FSM同步积.
　　定义2.FSM的同步积(Π).
　　给定两个对象FSM　M1和M2(同定义1)，同步积MR=M1ΠM2，MR:｛QR,ΣR,δ,q0R,QmR｝，其中
　　在控制器综合过程中，首先要建立与每一个静态规范和动态规范相对应的FSM形式.将TL公式转化成FSM形式是建立在TL的每一个框架与FMS同构基础之上的.这种同构给出一种充分条件，它确保所得到的对应于TL的FSM中，每一个TL公式都成立.有了每一个规范的FSM模型后，利用FSM同步积形式，给出受控系统的控制器.在Train-Gate系统中，系统模型M3与静态规范的FSM模型同步化后，得到系统的监控器M4.然后将监控器M4分别与动态规范(2)，(3)，(4)同构的FSM同步化后，得到系统局部控制器M5，M6和M7(这里省略其描述).最后M5,M6和M7的同步积，得到全局控制器M8.图4中给出监控器M4的描述，图5中给出全局控制器M8的描述.


图4　监控器M4


图5　全局控制器M8
4　实时控制器综合
4.1　用TFSM(Timed FSM)为实时离散事件系统建模
　　定义3.一个TFSM为六元组M=｛Q,Σ,C,δ,q0,Qm｝，C为有限时钟集合，δ为状态变迁函数，δ:Σ×2C×Q→Q，其他项的定义同FSM.TFSM每个动作都相应某一时间，因此对象的TFSM比FSM复杂，由表2给出.系统模型见图6所示.
表2　实时火车-道口系统状态变迁表(x,y分别为火车和闸门的时钟)

对象状态标记意义变量值转移标记意义关联时间限制
火车S0火车甚远011进邻区S0→S1x:=0
S1火车接近112进闸门S1→S2x＞2
S2火车在闸213远离去S2→S0x＞5
闸门S0闸门已开021关闸门S3→S4y:=0
S1闸门正关122闸门关闭S4→S5y＜1
S2闸门已关223开闸门S5→S6y:=0
S3闸门正开324闸门打开S6→S3(y＞1)∧(y＜2)


图6　火车-道口系统的实时FSM
4.2　用RTTL(Real-Time TL)给出实时离散事件系统的规范
　　在RTTL中,仍使用时态算子.与状态公式不同的是，一个时态公式不能在某一单一状态进行评价，而必须在某一状态序列上进行评价.下面给出实时Train-Gate系统的规范，
　　静态规范
　　(5)
　　动态规范
　　(6)
　　(7)
　　(8)
　　(9)
这里，符号z和x,y一样，表示与控制器有关的时钟.
4.3　实时控制器综合
　　实时离散事件系统控制器综合方法与第3节介绍的方法相同.首先，由受控系统的TFSMN1与静态规范的FSM进行同步积，得到监控器模型；然后，通过求监控器模型与动态规范的FSM的同步积，得到局部控制器；最后，所有局部控制器的同步积得到全局控制器N2.图7中给出了全局控制器N2.


图7　实时火车-道口系统的全局控制器N2
5　小结
　　下面给出实时控制器设计的一般步骤：
　　1)用TFSM为实时离散事件系统的每一个对象建模；
　　2)求系统中所有对象TFSM的同步积，建立整个系统TFSM模型；
　　3)对受控系统的性能需求以RTTL列出，与TFSM模型的相应行为对照；
　　4)求系统TFSM模型与静态规范的TFSM形式的同步积，得到系统的监控器模型；
　　5)求监控器模型与每一个动态规范的TFSM形式的同步积，得到系统局部控制器模型；
　　6)求所有局部控制器的同步积，得到全局控制器.
　　这种方法改进了传统控制器的设计原则，使系统能够按照我们所期望的行为变化.
作者简介：王　蓓　于西北工业大学本科毕业，并获硕士学位，1997年在上海交通大学获博士学位，目前在美国Wayne State University做研究工作.研究方向为离散事件系统中有关自动机和时态逻辑应用.
　　　　　吴智铭　上海交通大学自动化系教授.研究方向为离散事件系统.
作者单位：上海交通大学自动化系　上海　200030
参考文献
1　Ostroff J,Wonham W.A temporal logic approach to real time control.In:Proc.of the 24th CDC,Dec.1985,656～657
2　Ramadge P,Wonhanm W.Supervisory control of a class of discrete event processes.SIAM J.Control Optim,1987,25(5):1202～1228
3　Hoare C A R.通信顺序进程，周巢尘译.北京：北京大学出版社，1990年，45～53
收稿日期　1997-07-02　　收修改稿日期　1998-07-14
