微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000 Vol.19 No.2 P.43-44




工商企业IC卡的技术开发
易智雄
摘 要： IC卡的基础知识及读写IC卡的编程方法，以工商企业IC卡系统为例，介绍了IC卡管理系统的开发。
关键词： IC卡 数据库 IC卡读写
　　IC卡1974年诞生于法国，20多年间，其应用领域不断扩大。国际标准化组织从1987年开始，相继制定和颁布了IC卡的国际标准：ISO，7816－1，7816－2，7816－3，7816－4，为IC卡的进一步发展普及创造了条件。
　　IC卡是一种集成电路卡，它是随着半导体技术的发展以及社会对信息的安全性和存储容量要求的日益提高应运而生的。它将具有微处理器及大容量存储器的集成芯片嵌装于塑料基片上，它的外形与普通的信用卡完全相同。按其内部封装的芯片的种类和功能可分为智能卡（SMART CARD）和存储卡（MEMORY CARD）。存储卡和智能卡的区别就在于存储器内不含微处理器CPU，只具有一般的或带有逻辑控制的存储数据信息的功能。
　　IC卡保密性强，安全性高。它具有硬件安全策略，如果试图解密将造成卡的自锁或自毁。IC卡还有存储量大、使用方便、抗干扰强、网络要求不高等特点。因此虽然IC卡诞生时间不长，其市场就已经遍布世界各地，而其应用领域也从最初的银行信用卡单一领域，渗透于包括工商、税务、社会保险、医疗、电信、交通、企业管理等领域。
　　为改善行政执行手段，实现工商企业信息的自动化处理、传递、共享和交流，1996年，国家工商局决定进行发行工商企业IC卡的试点工作，制定IC卡全国统一标准，将企业登记注册的基本资料、年检信息、违法违章情况写入IC卡中，由企业自己持有。因为IC卡具有不可伪造的特点，并且此卡全国通用，所以可以为企业提供具有防伪功能的“电子身份证照”，有效地防止伪造营业执照签订合同的经济犯罪活动，保护企业自身利益，同时也有利于工商行政管理、税务、银行、海关、技术监督等部门进行检查监管工作。
1 IC卡的读写程序开发
1．1 IC卡的开发环境
　　读或写IC卡所需的硬件配置为1台PC电脑，1台IC卡读写机。IC卡读写机分为内置式和外置式2种。外置式IC卡读写机外接220V电源，通过RS－232串口与PC机连接。内置式读写机，外形尺寸如软驱一样，安装于PC机软驱支架上，使用PC机箱电源。软件配置为DOS、Windows 95／98，Windows NT等操作系统和IC卡读写机的接口函数库。IC卡读写机的制造厂家一般提供C、VB、Delphi，Foxpro、Powerbuilder等语言的接口函数库。
1．2 IC卡的存储区及其密码
　　一般而言，IC卡的存储区分为若干个应用区，或称页。这些应用区的容量可相等也可不相等。整个IC卡有1个卡安全密码，称为主密码。必须在核对此密码正确后，才能读或写IC卡内的各应用区。每个应用区都有1个读密码和写密码。当读某应用区的存储内容时，必须验证读密码正确。而将内容写入某应用区时，必须验证读密码和写密码都正确。因此，如果某类IC卡内有4个应用区，则共有9个密码。一般地，对于有些重要应用区的密码，IC卡内设有对应的错误计数器，每核对密码错误一次，计数器自动加1，如果错误次数达到IC卡的限定值，例如8次，则此卡片以后就不能再使用了。当错误次数未达到限定值，而输入了正确的密码后，则错误计数器自动清零。
　　IC卡正式交付使用前，还必须进行熔断操作。IC卡经熔断后，读写密码只能进行验证，不能再读出来显示。
1．3 IC卡读卡编程
　　要读出IC卡存储的内容，需要通过调用接口函数库提供的相应函数，依照下列步骤进行操作：定义引用的外部函数，检查串口是否联好，检查是否插卡，给卡上电，核对卡安全密码，核对所选区的读密码，读卡，给卡下电。 
　　下面以VB5．0 for Win95／98为例给出示范程序的主要语句，为简单起见，我们假设每个检测都成功，以便继续下一步操作。


1．4 IC卡写卡编程
　　写IC卡编程，依照以下步骤进行操作：
　　定义引用的外部函数，检查串口是否联好，检查是否插卡，给卡上电，初始化各区及其密码或核对卡主安全密码，核对所选区的读密码、写密码，写卡，熔断，给卡下电。
　　程序参照读卡部分，个别有所不同，如： 
　　写卡：dd＝icc＿write（com，″企业名称″，32，8）
　　熔断为：dd＝blown＿fuse（com）
2 工商企业IC卡系统开发
　　工商企业IC卡系统是以IC卡技术为核心，以工商行政管理数据库和计算机网络为基础，面向工商行政管理部门的一项信息自动化处理工程。以广州市工商企业IC卡系统为例，我们建立起以1台双CPU的Dell机作服务器，12台微机作工作站的基于Client／Server模式的计算机网络系统，网络操作系统选用Windows NT 4．0，数据库管理系统选用MS SQL Server 6．5／7．0，开发工具采用Visual Basic，Visual Foxpro等。工作站使用Windows 95／98。
2．1 数据库设计
　　我们在SQL Server上建立了2个数据库：企业资料库和制卡数据库。企业数据库中建立内资企业、外资企业、私营企业、行业代码表、企业类型代码表等十多张表。制卡数据库中建立了制卡信息表、用户组表、用户表、用户权限表等。其中制卡信息表存储制卡的信息，如制卡日期、数目、制卡人等。
　　在数据库中建立存储过程，供前台调用。下面是存储过程的1个例子，此过程用于取某卡号的信息。


2．2 系统功能设计
　　前台使用VB、Visual Foxpro编程，通过调后台存储过程和数据库实现各项功能。该系统设计了如下功能：
　　数据转换：将实时的Foxpro 2．5企业资料数据库转到SQL Server中。
　　制卡：通过注册号、企业名称等项目从后台数据库检索出企业，将此企业注册资料等信息写入IC卡。 
　　读卡：核对密码后，读出IC卡信息并显示出来。 
　　领卡：企业来领IC卡，读卡并在后台数据库作登记。 
　　查卡：查某个企业是否已制卡、已领卡。 
　　人员管理：设置操作人员权限。 
　　统计：按企业类型、时间范围、操作人员等类别对制卡信息进行统计。
　　IC卡的安全可靠性和大容量的特点，使其在应用中对计算机网络的要求不高，有利于在未联网的环境中使用，其应用领域也将越来越广。广州市工商企业IC卡系统的投入使用，完成了对全市的内资、外资、私营企业发行IC卡的工作，加强了工商企业的监督管理力度，取得较好的社会效益。
易智雄（广州市工商局经济信息中心510620）
参考文献
1，Jerke N．Visual Basic 5开发人员指南．北京：机械工业出版社，1998
2，Microsoft．Microsoft SQL Server 6．5管理员指南．北京： 科学出版社，1997
收稿日期：1999－08－10
